<!-- main.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <!-- Include Leaflet library -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Include Firebase Realtime Database SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAD3fc9vlLyOIpW9rS3kktkxwWB1htn4vE",
            authDomain: "trck-15337.firebaseapp.com",
            projectId: "trck-15337",
            storageBucket: "trck-15337.appspot.com",
            messagingSenderId: "521709429780",
            appId: "1:521709429780:web:651ea6b99173c82d9a3301",
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Reference to your Firebase Realtime Database
        const database = firebase.database();

        // Function to update the map with location data
        function updateMap(locationData) {
            // Clear existing markers and polylines
            for (var i = 0; i < markers.length; i++) {
                map.removeLayer(markers[i]);
            }
            redPolyline.setLatLngs([]); // Clear the polyline

            // Update your map with locationData
            for (var i = 0; i < locationData.length; i++) {
                var coords = locationData[i].split(',').map(function(coord) {
                    return parseFloat(coord.trim());
                });

                // Create a marker for each location
                var marker = L.marker(coords).addTo(map);
                markers.push(marker);

                // Add coordinates to the red line
                redPolyline.addLatLng(coords);
            }
        }

        // Create an array to hold the markers
        var markers = [];

        // Create a polyline for the red line
        var redPolyline = L.polyline([], {
            color: 'red',
            weight: 3
        }).addTo(map);

        var map = L.map('map').setView([45, -100], 4);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Listen for changes to the 'locations' node in the database
        const locationRef = database.ref('locations');

        locationRef.on('value', (snapshot) => {
            const locationData = snapshot.val();

            // Update the map with the new location data
            if (locationData) {
                updateMap(locationData);
            }
        });
    </script>
</head>

<body>
    <!-- Your map or visualization here -->
    <div id="map" style="height: 600px;"></div>
</body>

</html>
